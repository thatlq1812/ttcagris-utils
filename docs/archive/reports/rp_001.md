# REPORT 001: Project Analysis & Implementation Plan

## 1. Project Structure Analysis

Based on the workspace examination, the **AgriOS Backend** is structured as follows:

*   **Service:** `centre-auth-service` (Go/Golang)
*   **Database:** PostgreSQL (inferred from `.sql` migrations)
*   **Communication:** gRPC/Protobuf (defined in `Core/proto` and `centre-auth-service/proto`)

### Key Components for Supplier Management
*   **Database Schema:** The `suppliers` table is defined and modified across several migrations:
    *   `008_create_suppliers_table.sql`: Initial creation.
    *   `040_update_suppliers_table_schema.sql`: Major schema update.
    *   `046_change_suppliers_is_verified_to_status.sql`: Recent status change.
*   **Proto Definitions:** `Core/proto/supplier/v1` likely contains the gRPC service definitions for Supplier operations.

---

## 2. Gap Analysis (vs in_001.md)

This section compares the requirements in `in_001.md` with the current codebase.

### Task NLD-34: Supplier Deactivation (`is_deactivate`)
*   **Requirement:** Add `is_deactivate` (Boolean) to the `Suppliers` table and create an API to toggle it.
*   **Current State:**
    *   Checking `migrations/`, there is **no specific migration** explicitly named for adding `is_deactivate` yet, though `046_change_suppliers_is_verified_to_status.sql` might be related to status.
    *   **Action Required:**
        1.  Create a new SQL migration to add `is_deactivate` column (default `false`).
        2.  Update the Go struct model for Supplier.
        3.  Implement the `UpdateStatus` or `ToggleActive` API endpoint.

### Task NLD-30: Station Assignment (`station_id`)
*   **Requirement:** Add `station_id` to `Suppliers` and an API to assign it.
*   **Current State:**
    *   Need to verify if `station_id` exists in `040_update_suppliers_table_schema.sql` or subsequent migrations.
    *   **Action Required:**
        1.  If missing, create a migration to add `station_id` (likely nullable initially).
        2.  Update the Create/Update Supplier logic to handle this field.

---

## 3. Implementation Roadmap

Following the checklist in `in_001.md`, here is the technical execution plan:

### Step 1: Database Changes (Infrastructure)
Create a new migration file (e.g., `migrations/047_add_supplier_deactivate_and_station.sql`) containing:
```sql
ALTER TABLE suppliers ADD COLUMN IF NOT EXISTS is_deactivate BOOLEAN DEFAULT FALSE;
ALTER TABLE suppliers ADD COLUMN IF NOT EXISTS station_id VARCHAR(36); -- Assuming UUID or similar
```

### Step 2: Backend Implementation (Coding)
1.  **Update Proto:** Modify `Core/proto/supplier/v1/supplier.proto` to include `is_deactivate` and `station_id` in the Supplier message and Update requests.
2.  **Update Domain Models:** Update the Go struct in `centre-auth-service/internal/domain/supplier.go`.
3.  **Implement Logic:**
    *   Add `UpdateActiveStatus` method in Repository layer.
    *   Add UseCase logic to handle the toggle.
    *   Expose the gRPC/HTTP endpoint.

### Step 3: Verification
*   Verify the database schema changes.
*   Test the API using Postman or Swagger (as mentioned in `in_001.md`).

---

## 4. Next Steps for Developer

1.  Run `make migrate` (or equivalent command in `Makefile`) to ensure local DB is up to date with existing migrations.
2.  Check `Core/proto/supplier` to see existing message definitions.
3.  Begin **Phase 2** of `in_001.md` starting with Task NLD-3// filepath: docs/introductions/report_001.md
# REPORT 001: Project Analysis & Implementation Plan

## 1. Project Structure Analysis

Based on the workspace examination, the **AgriOS Backend** is structured as follows:

*   **Service:** `centre-auth-service` (Go/Golang)
*   **Database:** PostgreSQL (inferred from `.sql` migrations)
*   **Communication:** gRPC/Protobuf (defined in `Core/proto` and `centre-auth-service/proto`)

### Key Components for Supplier Management
*   **Database Schema:** The `suppliers` table is defined and modified across several migrations:
    *   `008_create_suppliers_table.sql`: Initial creation.
    *   `040_update_suppliers_table_schema.sql`: Major schema update.
    *   `046_change_suppliers_is_verified_to_status.sql`: Recent status change.
*   **Proto Definitions:** `Core/proto/supplier/v1` likely contains the gRPC service definitions for Supplier operations.

---

## 2. Gap Analysis (vs in_001.md)

This section compares the requirements in `in_001.md` with the current codebase.

### Task NLD-34: Supplier Deactivation (`is_deactivate`)
*   **Requirement:** Add `is_deactivate` (Boolean) to the `Suppliers` table and create an API to toggle it.
*   **Current State:**
    *   Checking `migrations/`, there is **no specific migration** explicitly named for adding `is_deactivate` yet, though `046_change_suppliers_is_verified_to_status.sql` might be related to status.
    *   **Action Required:**
        1.  Create a new SQL migration to add `is_deactivate` column (default `false`).
        2.  Update the Go struct model for Supplier.
        3.  Implement the `UpdateStatus` or `ToggleActive` API endpoint.

### Task NLD-30: Station Assignment (`station_id`)
*   **Requirement:** Add `station_id` to `Suppliers` and an API to assign it.
*   **Current State:**
    *   Need to verify if `station_id` exists in `040_update_suppliers_table_schema.sql` or subsequent migrations.
    *   **Action Required:**
        1.  If missing, create a migration to add `station_id` (likely nullable initially).
        2.  Update the Create/Update Supplier logic to handle this field.

---

## 3. Implementation Roadmap

Following the checklist in `in_001.md`, here is the technical execution plan:

### Step 1: Database Changes (Infrastructure)
Create a new migration file (e.g., `migrations/047_add_supplier_deactivate_and_station.sql`) containing:
```sql
ALTER TABLE suppliers ADD COLUMN IF NOT EXISTS is_deactivate BOOLEAN DEFAULT FALSE;
ALTER TABLE suppliers ADD COLUMN IF NOT EXISTS station_id VARCHAR(36); -- Assuming UUID or similar
```

### Step 2: Backend Implementation (Coding)
1.  **Update Proto:** Modify `Core/proto/supplier/v1/supplier.proto` to include `is_deactivate` and `station_id` in the Supplier message and Update requests.
2.  **Update Domain Models:** Update the Go struct in `centre-auth-service/internal/domain/supplier.go`.
3.  **Implement Logic:**
    *   Add `UpdateActiveStatus` method in Repository layer.
    *   Add UseCase logic to handle the toggle.
    *   Expose the gRPC/HTTP endpoint.

### Step 3: Verification
*   Verify the database schema changes.
*   Test the API using Postman or Swagger (as mentioned in `in_001.md`).

---

## 4. Next Steps for Developer

1.  Run `make migrate` (or equivalent command in `Makefile`) to ensure local DB is up to date with existing migrations.
2.  Check `Core/proto/supplier` to see existing message definitions.
3.  Begin **Phase 2** of `in_001.md` starting with Task NLD-3