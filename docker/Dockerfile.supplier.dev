# =============================================================================
# Dockerfile for Supplier Service (Development)
# =============================================================================
# This Dockerfile is used for local development with Docker Compose.
# It expects a pre-built Linux binary at supplier-service/bin/supplier-linux
#
# Build binary (Windows PowerShell):
#   $env:CGO_ENABLED="0"; $env:GOOS="linux"; $env:GOARCH="amd64"
#   cd supplier-service && go build -o bin/supplier-linux ./cmd/main.go && cd ..
#
# Build binary (Linux/macOS):
#   CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o supplier-service/bin/supplier-linux ./supplier-service/cmd/main.go
# =============================================================================

FROM alpine:3.19

RUN apk add --no-cache ca-certificates tzdata wget

WORKDIR /app

# Copy pre-built binary
COPY supplier-service/bin/supplier-linux /app/supplier-service

# Copy config
COPY supplier-service/config /app/config

# Make binary executable
RUN chmod +x /app/supplier-service

# Create non-root user
RUN addgroup -S appgroup && adduser -S appuser -G appgroup
RUN chown -R appuser:appgroup /app

USER appuser

# Expose ports (gRPC: 9088, HTTP: 8088)
EXPOSE 9088 8088

ENTRYPOINT ["/app/supplier-service"]
